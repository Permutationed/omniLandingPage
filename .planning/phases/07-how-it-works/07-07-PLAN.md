---
phase: 07-how-it-works
plan: 07
type: execute
wave: 2
depends_on: [07-05]
files_modified: [components/how-you-earn/unlock-rate/*, components/how-you-earn/how-you-earn-section.tsx]
autonomous: true

must_haves:
  truths:
    - "User sees horizontal progress bar showing spending progress"
    - "User sees two threshold markers at 20% and 40%"
    - "Progress bar fills as user scrolls through section"
    - "Threshold badges unlock with visual feedback when reached"
    - "Rate display updates from 0.5% to 1.0%"
  artifacts:
    - path: "components/how-you-earn/unlock-rate/unlock-rate.tsx"
      provides: "Main section component with scroll-linked progress animation"
    - path: "components/how-you-earn/unlock-rate/progress-gauge.tsx"
      provides: "Animated progress bar with threshold markers"
    - path: "components/how-you-earn/unlock-rate/threshold-badge.tsx"
      provides: "Lock/unlock badge component with animation"
    - path: "components/how-you-earn/unlock-rate/rate-display.tsx"
      provides: "Animated tuition rate display"
---

<objective>
Build the "Unlock Better Tuition Rates" section showing how everyday spending unlocks higher tuition reward rates.

Purpose: Explain the gamification mechanic that ties card usage to tuition rewards
Output: Progress gauge with threshold animations and rate display
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-how-it-works/07-RESEARCH-v2.md

# Dependencies from 07-05
@components/how-you-earn/shared/constants.ts
@components/how-you-earn/shared/odometer.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create threshold badge component</name>
  <files>components/how-you-earn/unlock-rate/threshold-badge.tsx</files>
  <action>
Create an animated badge that shows locked/unlocked state:

**`components/how-you-earn/unlock-rate/threshold-badge.tsx`**
```typescript
'use client'

import { motion, MotionValue, useTransform } from 'framer-motion'

interface ThresholdBadgeProps {
  /** The rate this threshold unlocks (e.g., 0.5, 1.0) */
  rate: number
  /** Label for the threshold (e.g., "20%", "40%") */
  thresholdLabel: string
  /** Scroll progress value */
  progress?: MotionValue<number>
  /** Progress value at which this threshold unlocks */
  unlockAt: number
  /** Whether this is the active/current rate */
  isActive?: boolean
  className?: string
}

/**
 * Animated threshold badge showing locked â†’ unlocked state
 */
export function ThresholdBadge({
  rate,
  thresholdLabel,
  progress,
  unlockAt,
  isActive = false,
  className = '',
}: ThresholdBadgeProps) {
  // Calculate unlock animation
  const unlocked = useTransform(
    progress ?? { get: () => 0 } as MotionValue<number>,
    [unlockAt - 0.05, unlockAt],
    [0, 1]
  )

  const scale = useTransform(unlocked, [0, 0.5, 1], [1, 1.15, 1])
  const opacity = useTransform(unlocked, [0, 1], [0.5, 1])

  // Glow effect when unlocked
  const glowOpacity = useTransform(unlocked, [0.8, 1], [0, 1])

  return (
    <div className={`flex flex-col items-center gap-2 ${className}`}>
      {/* Threshold label */}
      <span className="text-xs text-muted-foreground font-medium">
        {thresholdLabel}
      </span>

      {/* Badge */}
      <motion.div
        className="relative"
        style={{ scale }}
      >
        {/* Glow ring */}
        <motion.div
          className="absolute inset-0 rounded-xl bg-primary/30 blur-md"
          style={{ opacity: glowOpacity, scale: 1.2 }}
        />

        {/* Badge container */}
        <motion.div
          className={`
            relative px-4 py-2 rounded-xl border-2 font-bold text-lg
            ${isActive
              ? 'bg-primary text-primary-foreground border-primary'
              : 'bg-background border-border'
            }
          `}
          style={{ opacity }}
        >
          {/* Lock icon (shown when locked) */}
          <motion.span
            className="absolute -top-2 -right-2 text-sm"
            style={{
              opacity: useTransform(unlocked, [0, 0.5], [1, 0]),
              scale: useTransform(unlocked, [0, 0.5], [1, 0]),
            }}
          >
            ðŸ”’
          </motion.span>

          {/* Unlock icon (shown when unlocked) */}
          <motion.span
            className="absolute -top-2 -right-2 text-sm"
            style={{
              opacity: useTransform(unlocked, [0.5, 1], [0, 1]),
              scale: useTransform(unlocked, [0.5, 1], [0, 1]),
            }}
          >
            âœ“
          </motion.span>

          {/* Rate value */}
          <span>{rate}%</span>
        </motion.div>
      </motion.div>

      {/* Earnings example */}
      <motion.span
        className="text-xs text-muted-foreground"
        style={{
          opacity: useTransform(unlocked, [0.5, 1], [0.3, 1]),
        }}
      >
        ${(25000 * (rate / 100)).toLocaleString()} back
      </motion.span>
    </div>
  )
}
```
  </action>
  <verify>
1. File exists at components/how-you-earn/unlock-rate/threshold-badge.tsx
2. No TypeScript errors
  </verify>
  <done>
Threshold badge component created with lock/unlock animation
  </done>
</task>

<task type="auto">
  <name>Task 2: Create progress gauge component</name>
  <files>components/how-you-earn/unlock-rate/progress-gauge.tsx</files>
  <action>
Create the main progress bar with threshold markers:

**`components/how-you-earn/unlock-rate/progress-gauge.tsx`**
```typescript
'use client'

import { motion, MotionValue, useTransform } from 'framer-motion'
import { ThresholdBadge } from './threshold-badge'

interface ProgressGaugeProps {
  progress?: MotionValue<number>
  /** Range when progress bar fills [start, end] */
  fillRange?: [number, number]
  className?: string
}

/**
 * Animated progress bar showing spending progress toward rate unlocks
 */
export function ProgressGauge({
  progress,
  fillRange = [0.2, 0.8],
  className = '',
}: ProgressGaugeProps) {
  // Map scroll progress to gauge fill (0-50% of gauge, since 40% is max threshold)
  const fillWidth = useTransform(
    progress ?? { get: () => 0 } as MotionValue<number>,
    fillRange,
    ['0%', '50%'] // Fill to 50% of bar (representing 40% spending + some buffer)
  )

  // Progress value for threshold badges
  const gaugeProgress = useTransform(
    progress ?? { get: () => 0 } as MotionValue<number>,
    fillRange,
    [0, 1]
  )

  return (
    <div className={`w-full max-w-2xl mx-auto ${className}`}>
      {/* Card icon and label */}
      <div className="flex items-center gap-3 mb-4">
        <div className="w-10 h-6 bg-gradient-to-br from-primary to-primary/70 rounded-md flex items-center justify-center">
          <span className="text-white text-xs font-bold">OMNI</span>
        </div>
        <span className="text-sm font-medium text-muted-foreground">
          YOUR EVERYDAY SPENDING
        </span>
      </div>

      {/* Progress bar container */}
      <div className="relative">
        {/* Background track */}
        <div className="h-4 bg-muted rounded-full overflow-hidden">
          {/* Animated fill */}
          <motion.div
            className="h-full bg-gradient-to-r from-primary via-primary to-green-500 rounded-full"
            style={{ width: fillWidth }}
          />
        </div>

        {/* Threshold markers on the bar */}
        <div className="absolute top-0 left-0 w-full h-4 pointer-events-none">
          {/* 20% marker line */}
          <div
            className="absolute top-0 h-full w-0.5 bg-foreground/30"
            style={{ left: '25%' }} // 20% threshold at 25% visual position
          />
          {/* 40% marker line */}
          <div
            className="absolute top-0 h-full w-0.5 bg-foreground/30"
            style={{ left: '50%' }} // 40% threshold at 50% visual position
          />
        </div>
      </div>

      {/* Threshold badges below bar */}
      <div className="relative mt-8 flex justify-between px-4">
        {/* 0% start */}
        <div className="text-xs text-muted-foreground">
          0%
        </div>

        {/* 20% threshold */}
        <div className="absolute" style={{ left: '25%', transform: 'translateX(-50%)' }}>
          <ThresholdBadge
            rate={0.5}
            thresholdLabel="20% spent"
            progress={gaugeProgress}
            unlockAt={0.4} // Unlock at 40% of animation progress
          />
        </div>

        {/* 40% threshold */}
        <div className="absolute" style={{ left: '50%', transform: 'translateX(-50%)' }}>
          <ThresholdBadge
            rate={1.0}
            thresholdLabel="40% spent"
            progress={gaugeProgress}
            unlockAt={0.8} // Unlock at 80% of animation progress
            isActive
          />
        </div>

        {/* Spacer for layout */}
        <div className="opacity-0">100%</div>
      </div>
    </div>
  )
}
```
  </action>
  <verify>
1. File exists at components/how-you-earn/unlock-rate/progress-gauge.tsx
2. No TypeScript errors
  </verify>
  <done>
Progress gauge component created with animated fill and threshold markers
  </done>
</task>

<task type="auto">
  <name>Task 3: Create rate display component</name>
  <files>components/how-you-earn/unlock-rate/rate-display.tsx</files>
  <action>
Create the animated current rate display:

**`components/how-you-earn/unlock-rate/rate-display.tsx`**
```typescript
'use client'

import { motion, MotionValue, useTransform, AnimatePresence } from 'framer-motion'

interface RateDisplayProps {
  progress?: MotionValue<number>
  /** Progress value at which rate changes from 0.5 to 1.0 */
  transitionAt?: number
  className?: string
}

/**
 * Animated display showing current tuition reward rate
 */
export function RateDisplay({
  progress,
  transitionAt = 0.7,
  className = '',
}: RateDisplayProps) {
  // Determine which rate to show based on progress
  const rateIndex = useTransform(
    progress ?? { get: () => 0 } as MotionValue<number>,
    [0, transitionAt - 0.1, transitionAt],
    [0, 0, 1]
  )

  const opacity = useTransform(
    progress ?? { get: () => 0 } as MotionValue<number>,
    [0.1, 0.2],
    [0, 1]
  )

  const scale = useTransform(
    progress ?? { get: () => 0 } as MotionValue<number>,
    [transitionAt - 0.05, transitionAt, transitionAt + 0.05],
    [1, 1.1, 1]
  )

  return (
    <motion.div
      className={`text-center ${className}`}
      style={{ opacity }}
    >
      <div className="text-sm text-muted-foreground mb-2 uppercase tracking-wide">
        Your Tuition Reward Rate
      </div>

      <motion.div
        className="relative inline-flex items-center gap-4"
        style={{ scale }}
      >
        {/* Previous rate (crossed out when upgraded) */}
        <motion.span
          className="text-2xl text-muted-foreground relative"
          style={{
            opacity: useTransform(rateIndex, [0, 1], [0.5, 0.3]),
          }}
        >
          0.5%
          <motion.span
            className="absolute left-0 right-0 top-1/2 h-0.5 bg-muted-foreground"
            style={{
              scaleX: useTransform(rateIndex, [0.5, 1], [0, 1]),
              transformOrigin: 'left',
            }}
          />
        </motion.span>

        {/* Arrow */}
        <motion.span
          className="text-primary"
          style={{
            opacity: useTransform(rateIndex, [0.5, 1], [0, 1]),
          }}
        >
          â†’
        </motion.span>

        {/* Current/new rate */}
        <motion.span
          className="text-4xl md:text-5xl font-bold"
          style={{
            color: useTransform(
              rateIndex,
              [0, 1],
              ['oklch(0.65 0.25 260)', 'oklch(0.70 0.20 145)']
            ),
          }}
        >
          <motion.span
            style={{
              opacity: useTransform(rateIndex, [0, 0.5], [1, 0]),
              position: 'absolute',
            }}
          >
            0.5%
          </motion.span>
          <motion.span
            style={{
              opacity: useTransform(rateIndex, [0.5, 1], [0, 1]),
            }}
          >
            1.0%
          </motion.span>
        </motion.span>
      </motion.div>

      {/* Earnings example */}
      <motion.div
        className="mt-4 text-muted-foreground"
        style={{
          opacity: useTransform(
            progress ?? { get: () => 0 } as MotionValue<number>,
            [0.8, 0.9],
            [0, 1]
          ),
        }}
      >
        <motion.span
          style={{
            opacity: useTransform(rateIndex, [0.5, 1], [1, 0]),
            display: 'inline-block',
          }}
        >
          Earn <strong>$125</strong> on $25,000 tuition
        </motion.span>
        <motion.span
          style={{
            opacity: useTransform(rateIndex, [0.5, 1], [0, 1]),
            display: 'inline-block',
            marginLeft: '-100%',
          }}
        >
          Earn <strong className="text-green-600">$250</strong> on $25,000 tuition
        </motion.span>
      </motion.div>
    </motion.div>
  )
}
```
  </action>
  <verify>
1. File exists at components/how-you-earn/unlock-rate/rate-display.tsx
2. No TypeScript errors
  </verify>
  <done>
Rate display component created with animated transition between rates
  </done>
</task>

<task type="auto">
  <name>Task 4: Create main UnlockRate section</name>
  <files>components/how-you-earn/unlock-rate/unlock-rate.tsx, components/how-you-earn/unlock-rate/index.ts</files>
  <action>
Create the main section component:

**`components/how-you-earn/unlock-rate/unlock-rate.tsx`**
```typescript
'use client'

import { useRef } from 'react'
import { useScroll, motion, useTransform } from 'framer-motion'
import { ProgressGauge } from './progress-gauge'
import { RateDisplay } from './rate-display'

/**
 * Section 2: Unlock Better Tuition Rates
 *
 * Shows how everyday spending unlocks higher tuition reward rates
 * Progress bar fills as user scrolls, unlocking threshold badges
 */
export function UnlockRate() {
  const sectionRef = useRef<HTMLElement>(null)

  const { scrollYProgress } = useScroll({
    target: sectionRef,
    offset: ['start end', 'end start'],
  })

  // Map scroll to animation progress
  const animationProgress = useTransform(
    scrollYProgress,
    [0.15, 0.65],
    [0, 1]
  )

  return (
    <section
      ref={sectionRef}
      className="min-h-screen py-24 md:py-32 flex flex-col items-center justify-center relative overflow-hidden"
    >
      {/* Background */}
      <div className="absolute inset-0 bg-gradient-to-b from-muted/30 via-background to-muted/30 pointer-events-none" />

      <div className="container mx-auto px-4 relative z-10">
        {/* Header */}
        <motion.div
          className="text-center mb-12 md:mb-16"
          style={{
            opacity: useTransform(animationProgress, [0, 0.1], [0, 1]),
            y: useTransform(animationProgress, [0, 0.1], [30, 0]),
          }}
        >
          <h2 className="text-3xl md:text-4xl lg:text-5xl font-bold mb-4">
            Unlock Better Tuition Rates
          </h2>
          <p className="text-muted-foreground text-lg md:text-xl max-w-2xl mx-auto">
            Use your Omni card for everyday purchases.
            The more you spend, the more you earn on tuition.
          </p>
        </motion.div>

        {/* Progress gauge card */}
        <motion.div
          className="bg-background/80 backdrop-blur-sm rounded-2xl border border-border p-6 md:p-10 shadow-lg max-w-3xl mx-auto"
          style={{
            opacity: useTransform(animationProgress, [0.05, 0.15], [0, 1]),
            y: useTransform(animationProgress, [0.05, 0.15], [40, 0]),
          }}
        >
          <ProgressGauge
            progress={animationProgress}
            fillRange={[0.15, 0.75]}
          />
        </motion.div>

        {/* Rate display */}
        <div className="mt-12 md:mt-16">
          <RateDisplay
            progress={animationProgress}
            transitionAt={0.75}
          />
        </div>

        {/* Explanation cards */}
        <motion.div
          className="mt-12 grid md:grid-cols-2 gap-6 max-w-2xl mx-auto"
          style={{
            opacity: useTransform(animationProgress, [0.85, 0.95], [0, 1]),
            y: useTransform(animationProgress, [0.85, 0.95], [20, 0]),
          }}
        >
          <div className="bg-muted/50 rounded-xl p-5 text-center">
            <div className="text-2xl font-bold text-primary mb-1">$5,000</div>
            <div className="text-sm text-muted-foreground">
              everyday spending unlocks <strong>0.5%</strong> tuition rate
            </div>
          </div>
          <div className="bg-muted/50 rounded-xl p-5 text-center">
            <div className="text-2xl font-bold text-green-600 mb-1">$10,000</div>
            <div className="text-sm text-muted-foreground">
              everyday spending unlocks <strong>1.0%</strong> tuition rate
            </div>
          </div>
        </motion.div>
      </div>
    </section>
  )
}
```

**`components/how-you-earn/unlock-rate/index.ts`**
```typescript
export { UnlockRate } from './unlock-rate'
export { ProgressGauge } from './progress-gauge'
export { ThresholdBadge } from './threshold-badge'
export { RateDisplay } from './rate-display'
```
  </action>
  <verify>
1. Both files exist
2. UnlockRate exports correctly
3. No TypeScript errors
  </verify>
  <done>
Main UnlockRate section created with progress gauge and rate display
  </done>
</task>

<task type="auto">
  <name>Task 5: Integrate into HowYouEarnSection</name>
  <files>components/how-you-earn/how-you-earn-section.tsx</files>
  <action>
Update the main section to use the real UnlockRate component:

1. Add import: `import { UnlockRate } from './unlock-rate'`
2. Replace `<UnlockRatePlaceholder />` with `<UnlockRate />`
3. Keep the remaining placeholders for now

The updated component should render:
- TuitionRewards (real)
- UnlockRate (real)
- DiscoverRewardsPlaceholder
- RewardsLoopPlaceholder
  </action>
  <verify>
1. Run `npm run build` - should pass
2. Run `npm run dev`
3. Visit localhost:3000 and scroll to second "How You Earn" section
4. Observe:
   - Progress bar fills as you scroll
   - 20% threshold badge unlocks with glow
   - 40% threshold badge unlocks
   - Rate display transitions from 0.5% to 1.0%
5. Test on mobile viewport - should stack vertically
  </verify>
  <done>
UnlockRate integrated into main section, progress animations working
  </done>
</task>

</tasks>

<verification>
After completing all tasks:

1. **File structure:**
   - components/how-you-earn/unlock-rate/index.ts
   - components/how-you-earn/unlock-rate/unlock-rate.tsx
   - components/how-you-earn/unlock-rate/progress-gauge.tsx
   - components/how-you-earn/unlock-rate/threshold-badge.tsx
   - components/how-you-earn/unlock-rate/rate-display.tsx

2. **Visual verification:**
   - Progress bar fills smoothly on scroll
   - Threshold badges show lock â†’ unlock animation
   - 0.5% badge unlocks first, then 1.0%
   - Rate display transitions with crossfade
   - Explanation cards fade in at end

3. **Performance:**
   - Smooth 60fps scroll
   - No jank during threshold transitions
   - GPU-accelerated animations

4. **Responsive:**
   - Progress bar scales properly
   - Badges reposition on mobile
   - Text remains readable
</verification>

<success_criteria>
- Progress gauge fills based on scroll progress
- Threshold badges animate lock â†’ unlock
- Rate display transitions from 0.5% to 1.0%
- Explanation cards show concrete examples
- All animations scroll-linked
- Build passes
</success_criteria>

<output>
After completion, create `.planning/phases/07-how-it-works/07-07-SUMMARY.md`
</output>
